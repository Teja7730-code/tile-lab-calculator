<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Tile Lab Calculator</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<style>
body{
margin:0;
font-family:-apple-system, BlinkMacSystemFont, sans-serif;
background:linear-gradient(180deg,#cfd9df,#e2ebf0);
display:flex;
justify-content:center;
align-items:center;
height:100vh;
}

.glass{
backdrop-filter: blur(25px);
background:rgba(255,255,255,0.45);
border-radius:30px;
padding:40px;
width:380px;
box-shadow:
0 15px 40px rgba(0,0,0,0.15),
inset 0 0 0 1px rgba(255,255,255,0.6);
transition:0.4s ease;
}

h1{
text-align:center;
margin-bottom:30px;
font-weight:600;
}

input, textarea{
width:100%;
padding:14px;
border-radius:18px;
border:none;
margin-bottom:15px;
background:rgba(255,255,255,0.6);
font-size:16px;
outline:none;
}

button{
padding:12px 25px;
border:none;
border-radius:20px;
cursor:pointer;
font-size:15px;
margin-top:5px;
transition:0.3s;
}

.primary{
background:linear-gradient(135deg,#3a8dde,#00c6ff);
color:white;
box-shadow:0 6px 20px rgba(0,0,0,0.2);
}

.secondary{
background:rgba(255,255,255,0.6);
}

.danger{
background:linear-gradient(135deg,#ff5f6d,#ff9966);
color:white;
}

.card-btn{
width:100%;
margin:10px 0;
}

.hidden{display:none;}

.result{
margin-top:20px;
font-size:18px;
font-weight:600;
text-align:center;
}

.test-item{
padding:10px;
margin:8px 0;
background:rgba(255,255,255,0.6);
border-radius:15px;
cursor:pointer;
}
</style>
</head>
<body>

<div class="glass">

<h1>Tile Lab</h1>

<div id="loginView">
<input type="email" id="email" placeholder="Email">
<input type="password" id="password" placeholder="Password">
<button class="primary" onclick="login()">Login</button>
</div>

<div id="dashboardView" class="hidden">

<div id="adminCard" class="hidden">
<button class="primary card-btn" onclick="openAddTest()">Add Test</button>
</div>

<button class="secondary card-btn" onclick="openAvailable()">Available Tests</button>

<button class="danger card-btn" onclick="logout()">Logout</button>

</div>

<div id="addTestView" class="hidden">
<h3>Add New Test</h3>
<input id="testName" placeholder="Test Name">
<textarea id="testCode" placeholder="Paste calculation JS code"></textarea>
<button class="primary" onclick="addTest()">Add</button>
<button class="secondary" onclick="back()">Back</button>
</div>

<div id="availableView" class="hidden">
<h3>Available Tests</h3>
<div id="testsList"></div>
<button class="secondary" onclick="back()">Back</button>
</div>

<div id="testRunView" class="hidden">
<h3 id="runTitle"></h3>
<div id="runContent"></div>
<button class="secondary" onclick="back()">Back</button>
</div>

</div>

<script type="module">

import { initializeApp } from "https://www.gstatic.com/firebasejs/10.9.0/firebase-app.js";
import { getAuth, signInWithEmailAndPassword, signOut, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.9.0/firebase-auth.js";
import { getFirestore, collection, addDoc, getDocs } from "https://www.gstatic.com/firebasejs/10.9.0/firebase-firestore.js";

const firebaseConfig = {
apiKey: "AIzaSyBUUqKaKs9-vDaAoWE2UorKD90SoQe-iMA",
authDomain: "tiles-a850f.firebaseapp.com",
projectId: "tiles-a850f"
};

const app = initializeApp(firebaseConfig);
const auth = getAuth(app);
const db = getFirestore(app);

const ADMIN_EMAIL = "admin@tilelab.com";

window.login = async function(){
const email=document.getElementById("email").value;
const pass=document.getElementById("password").value;
await signInWithEmailAndPassword(auth,email,pass);
}

window.logout = function(){
signOut(auth);
}

onAuthStateChanged(auth,user=>{
if(user){
document.getElementById("loginView").classList.add("hidden");
document.getElementById("dashboardView").classList.remove("hidden");

if(user.email.trim().toLowerCase() === ADMIN_EMAIL){
document.getElementById("adminCard").classList.remove("hidden");
}else{
document.getElementById("adminCard").classList.add("hidden");
}
}else{
document.getElementById("loginView").classList.remove("hidden");
document.getElementById("dashboardView").classList.add("hidden");
}
});

window.openAddTest=function(){
hideAll();
document.getElementById("addTestView").classList.remove("hidden");
}

window.openAvailable=async function(){
hideAll();
document.getElementById("availableView").classList.remove("hidden");

const snap = await getDocs(collection(db,"tests"));
let html="";
snap.forEach(doc=>{
const data=doc.data();
html+=`<div class="test-item" onclick='runTest(${JSON.stringify(data.code)})'>${data.name}</div>`;
});
document.getElementById("testsList").innerHTML=html;
}

window.addTest=async function(){
const name=document.getElementById("testName").value;
const code=document.getElementById("testCode").value;

await addDoc(collection(db,"tests"),{
name:name,
code:code
});

alert("Test Added");
}

window.runTest=function(code){
hideAll();
document.getElementById("testRunView").classList.remove("hidden");
document.getElementById("runTitle").innerText="Run Test";

document.getElementById("runContent").innerHTML=`
<input id="v1" placeholder="Value 1">
<input id="v2" placeholder="Value 2">
<button class="primary" onclick="calculate(\`${code}\`)">Calculate</button>
<div class="result" id="result"></div>
`;
}

window.calculate=function(code){
const v1=parseFloat(document.getElementById("v1").value);
const v2=parseFloat(document.getElementById("v2").value);
let result=eval(code);
document.getElementById("result").innerText="Result = "+result;
}

function hideAll(){
document.getElementById("addTestView").classList.add("hidden");
document.getElementById("availableView").classList.add("hidden");
document.getElementById("testRunView").classList.add("hidden");
document.getElementById("dashboardView").classList.add("hidden");
document.getElementById("dashboardView").classList.remove("hidden");
}

window.back=function(){
hideAll();
}

</script>

</body>
</html>
