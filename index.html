<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Tile Lab System</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
body{
margin:0;
font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto;
background:linear-gradient(135deg,#dbeafe,#e0f2fe,#f8fafc);
display:flex;
justify-content:center;
align-items:center;
height:100vh;
}

.glass{
background:rgba(255,255,255,0.45);
backdrop-filter:blur(30px);
border-radius:30px;
padding:40px;
width:440px;
box-shadow:0 25px 50px rgba(0,0,0,0.1);
text-align:center;
}

button{
padding:12px 25px;
border:none;
border-radius:40px;
margin:8px;
font-weight:600;
cursor:pointer;
}

.primary{
background:linear-gradient(135deg,#3b82f6,#06b6d4);
color:white;
}

.danger{
background:linear-gradient(135deg,#ef4444,#f97316);
color:white;
}

input, textarea{
width:85%;
padding:12px;
border-radius:20px;
border:none;
margin:8px 0;
text-align:center;
}

.result-box{
margin-top:20px;
padding:15px;
border-radius:20px;
background:rgba(255,255,255,0.7);
font-weight:600;
}

.hidden{display:none;}
</style>
</head>

<body>

<div class="glass" id="loginCard">
<h2>Tile Lab System</h2>
<input type="email" id="email" placeholder="Email">
<input type="password" id="password" placeholder="Password">
<button class="primary" onclick="login()">Login</button>
</div>

<div class="glass hidden" id="dashboard">
<h2 id="welcome"></h2>
<div id="adminPanel" class="hidden">
<h3>Add New Test</h3>
<input id="testName" placeholder="Test Name">
<input id="testInputs" placeholder="Inputs (comma separated e.g. W1,W2)">
<textarea id="testFormula" placeholder="Formula (e.g. (W2-W1)/W1*100)"></textarea>
<input id="testUnit" placeholder="Unit (e.g. %)">
<button class="primary" onclick="addTest()">Add Test</button>
<hr>
</div>

<h3>Available Tests</h3>
<div id="testsList"></div>

<button class="danger" onclick="logout()">Logout</button>
</div>

<div class="glass hidden" id="calculatorCard">
<h2 id="calcTitle"></h2>
<div id="calcInputs"></div>
<div class="result-box hidden" id="resultBox"></div>
<button class="primary" onclick="calculate()">Calculate</button>
<button onclick="back()">Back</button>
</div>

<script type="module">

import { initializeApp } from "https://www.gstatic.com/firebasejs/12.9.0/firebase-app.js";
import { getAuth, signInWithEmailAndPassword, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/12.9.0/firebase-auth.js";
import { getFirestore, collection, addDoc, getDocs } from "https://www.gstatic.com/firebasejs/12.9.0/firebase-firestore.js";

const firebaseConfig = {
apiKey: "AIzaSyBUUqKaKs9-vDaAoWE2UorKD90SoQe-iMA",
authDomain: "tiles-a850f.firebaseapp.com",
projectId: "tiles-a850f",
storageBucket: "tiles-a850f.firebasestorage.app",
messagingSenderId: "1070603762129",
appId: "1:1070603762129:web:7cd3889cbad403320d8f0"
};

const ADMIN_EMAIL = "admin@tilelab.com";

const app = initializeApp(firebaseConfig);
const auth = getAuth(app);
const db = getFirestore(app);

let currentTest = null;

window.login = () => {
signInWithEmailAndPassword(auth,email.value,password.value)
.catch(e=>alert(e.message));
};

window.logout = () => signOut(auth);

onAuthStateChanged(auth,user=>{
if(user){
loginCard.classList.add("hidden");
dashboard.classList.remove("hidden");
welcome.innerHTML="Welcome " + user.email;

if(user.email === ADMIN_EMAIL){
adminPanel.classList.remove("hidden");
}

loadTests();
}
else{
loginCard.classList.remove("hidden");
dashboard.classList.add("hidden");
}
});

async function loadTests(){
testsList.innerHTML="";
const querySnapshot = await getDocs(collection(db,"tests"));
querySnapshot.forEach(doc=>{
let data=doc.data();
let btn=document.createElement("button");
btn.className="primary";
btn.innerHTML=data.name;
btn.onclick=()=>openCalculator(data);
testsList.appendChild(btn);
});
}

window.addTest = async ()=>{
let name=testName.value;
let inputs=testInputs.value.split(",");
let formula=testFormula.value;
let unit=testUnit.value;

await addDoc(collection(db,"tests"),{
name:name,
inputs:inputs,
formula:formula,
unit:unit
});

alert("Test Added");
loadTests();
};

function openCalculator(test){
currentTest=test;
dashboard.classList.add("hidden");
calculatorCard.classList.remove("hidden");
calcTitle.innerHTML=test.name;
calcInputs.innerHTML="";
resultBox.classList.add("hidden");

test.inputs.forEach(input=>{
let field=document.createElement("input");
field.id=input.trim();
field.placeholder=input.trim();
calcInputs.appendChild(field);
});
}

window.calculate = ()=>{
let values={};

currentTest.inputs.forEach(input=>{
values[input.trim()]=parseFloat(document.getElementById(input.trim()).value);
});

let formula=currentTest.formula;
let result;

try{
result = Function(...Object.keys(values), "return " + formula)
(...Object.values(values));
}
catch(e){
alert("Formula Error");
return;
}

resultBox.innerHTML="Result = " + result.toFixed(3) + " " + currentTest.unit;
resultBox.classList.remove("hidden");
};

window.back = ()=>{
calculatorCard.classList.add("hidden");
dashboard.classList.remove("hidden");
};

</script>
</body>
</html>
