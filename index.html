<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Tile Lab</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<style>
body{
margin:0;
font-family:-apple-system,BlinkMacSystemFont,sans-serif;
background:linear-gradient(180deg,#dbe4ea,#e6eef4);
display:flex;
justify-content:center;
align-items:center;
height:100vh;
}

.glass{
backdrop-filter:blur(30px);
background:rgba(255,255,255,0.45);
border-radius:30px;
padding:35px;
width:390px;
box-shadow:
0 20px 45px rgba(0,0,0,0.15),
inset 0 0 0 1px rgba(255,255,255,0.7);
transition:0.3s ease;
}

h1{text-align:center;margin-bottom:25px;}

input,textarea{
width:100%;
padding:14px;
border:none;
border-radius:18px;
background:rgba(255,255,255,0.7);
margin-bottom:15px;
font-size:15px;
outline:none;
}

button{
padding:12px 22px;
border:none;
border-radius:20px;
cursor:pointer;
font-size:14px;
margin-top:8px;
transition:0.3s;
}

.primary{
background:linear-gradient(135deg,#3a8dde,#00c6ff);
color:white;
}

.secondary{
background:rgba(255,255,255,0.6);
}

.danger{
background:linear-gradient(135deg,#ff5f6d,#ff9966);
color:white;
}

.card-btn{
width:100%;
margin:10px 0;
}

.hidden{display:none;}

.test-item{
padding:12px;
background:rgba(255,255,255,0.6);
border-radius:15px;
margin-bottom:10px;
cursor:pointer;
}

.result{
margin-top:20px;
font-weight:600;
text-align:center;
font-size:18px;
}
</style>
</head>

<body>

<div class="glass">

<h1>Tile Lab</h1>

<!-- LOGIN -->
<div id="loginView">
<input id="email" placeholder="Email">
<input type="password" id="password" placeholder="Password">
<button class="primary" onclick="login()">Login</button>
</div>

<!-- DASHBOARD -->
<div id="dashboardView" class="hidden">
<div id="adminCard" class="hidden">
<button class="primary card-btn" onclick="openAdd()">Add Test</button>
</div>
<button class="secondary card-btn" onclick="openAvailable()">Available Tests</button>
<button class="danger card-btn" onclick="logout()">Logout</button>
</div>

<!-- ADD TEST -->
<div id="addView" class="hidden">
<h3>Add Test</h3>
<input id="testName" placeholder="Test Name">
<textarea id="testCode" placeholder="Example: ((v2 - v1) / v1 * 100).toFixed(2) + ' %'"></textarea>
<button class="primary" onclick="addTest()">Add Test</button>
<button class="secondary" onclick="goDashboard()">Back</button>
</div>

<!-- AVAILABLE -->
<div id="availableView" class="hidden">
<h3>Available Tests</h3>
<div id="testsList"></div>
<button class="secondary" onclick="goDashboard()">Back</button>
</div>

<!-- RUN TEST -->
<div id="runView" class="hidden">
<h3 id="runTitle"></h3>
<input id="v1" placeholder="Value 1">
<input id="v2" placeholder="Value 2">
<button class="primary" onclick="calculate()">Calculate</button>
<div class="result" id="result"></div>
<button class="secondary" onclick="goDashboard()">Back</button>
</div>

</div>

<script type="module">

import { initializeApp } from "https://www.gstatic.com/firebasejs/10.9.0/firebase-app.js";
import { getAuth, signInWithEmailAndPassword, signOut, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.9.0/firebase-auth.js";
import { getFirestore, collection, addDoc, getDocs } from "https://www.gstatic.com/firebasejs/10.9.0/firebase-firestore.js";

const firebaseConfig = {
apiKey: "AIzaSyBUUqKaKs9-vDaAoWE2UorKD90SoQe-iMA",
authDomain: "tiles-a850f.firebaseapp.com",
projectId: "tiles-a850f"
};

const app = initializeApp(firebaseConfig);
const auth = getAuth(app);
const db = getFirestore(app);

const ADMIN_EMAIL = "admin@tilelab.com";
let currentCode="";

window.login = async function(){
const email=emailInput.value.trim();
const pass=password.value;
try{
await signInWithEmailAndPassword(auth,email,pass);
}catch(e){alert("Login Failed");}
}

window.logout = function(){ signOut(auth); }

onAuthStateChanged(auth,user=>{
resetViews();
if(user){
dashboardView.classList.remove("hidden");
if(user.email.trim().toLowerCase()===ADMIN_EMAIL){
adminCard.classList.remove("hidden");
}
}else{
loginView.classList.remove("hidden");
}
});

function resetViews(){
loginView.classList.add("hidden");
dashboardView.classList.add("hidden");
addView.classList.add("hidden");
availableView.classList.add("hidden");
runView.classList.add("hidden");
adminCard.classList.add("hidden");
}

window.openAdd=function(){
resetViews();
addView.classList.remove("hidden");
}

window.openAvailable=async function(){
resetViews();
availableView.classList.remove("hidden");
testsList.innerHTML="Loading...";

const snap=await getDocs(collection(db,"tests"));

if(snap.empty){
testsList.innerHTML="No tests available";
return;
}

let html="";
snap.forEach(doc=>{
const data=doc.data();
html+=`<div class="test-item" onclick="runTest(\`${data.code}\`,'${data.name}')">${data.name}</div>`;
});
testsList.innerHTML=html;
}

window.addTest=async function(){
const name=testName.value.trim();
const code=testCode.value.trim();

if(!name||!code){alert("Fill all fields");return;}

await addDoc(collection(db,"tests"),{name:name,code:code});
alert("Test Added Successfully");

testName.value="";
testCode.value="";
}

window.runTest=function(code,name){
resetViews();
runView.classList.remove("hidden");
runTitle.innerText=name;
currentCode=code;
result.innerText="";
v1.value="";
v2.value="";
}

window.calculate=function(){
const val1=parseFloat(v1.value);
const val2=parseFloat(v2.value);
if(isNaN(val1)||isNaN(val2)){alert("Enter valid numbers");return;}
const v1=val1;
const v2=val2;
let output=eval(currentCode);
result.innerText="Result = "+output;
}

window.goDashboard=function(){
resetViews();
dashboardView.classList.remove("hidden");
}

</script>

</body>
</html>
