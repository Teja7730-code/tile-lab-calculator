<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Tile Lab System</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
body{
margin:0;
font-family:-apple-system,BlinkMacSystemFont,"SF Pro Display",Roboto;
background:linear-gradient(140deg,#e8edf7,#f5f7fb,#eef1f7);
height:100vh;
display:flex;
justify-content:center;
align-items:center;
overflow:hidden;
}

/* floating glass window */
.window{
width:520px;
background:rgba(255,255,255,0.65);
backdrop-filter:blur(30px);
border-radius:28px;
padding:35px;
box-shadow:
0 40px 80px rgba(0,0,0,0.15),
inset 0 1px 0 rgba(255,255,255,0.8);
position:relative;
transition:all 0.4s ease;
}

h2{
margin-top:0;
font-weight:600;
letter-spacing:0.3px;
}

input,textarea{
width:100%;
padding:12px;
margin:8px 0;
border-radius:18px;
border:none;
background:rgba(255,255,255,0.8);
font-size:14px;
outline:none;
}

textarea{height:120px;}

button{
padding:10px 20px;
border:none;
border-radius:25px;
font-weight:600;
cursor:pointer;
margin:6px 4px;
transition:all 0.2s ease;
}

.primary{
background:#3b82f6;
color:white;
}

.primary:hover{
transform:translateY(-2px);
box-shadow:0 10px 20px rgba(59,130,246,0.4);
}

.danger{
background:#ef4444;
color:white;
}

.card-grid{
display:grid;
grid-template-columns:1fr 1fr;
gap:12px;
margin-top:15px;
}

.dashboard-card{
background:rgba(255,255,255,0.8);
padding:20px;
border-radius:20px;
cursor:pointer;
text-align:center;
font-weight:600;
transition:0.25s;
}

.dashboard-card:hover{
transform:translateY(-3px);
box-shadow:0 10px 20px rgba(0,0,0,0.1);
}

.result{
background:rgba(255,255,255,0.9);
padding:12px;
border-radius:18px;
margin-top:10px;
font-weight:600;
}

.hidden{display:none;}
</style>
</head>

<body>

<div class="window">

<!-- LOGIN -->
<div id="loginView">
<h2>Tile Lab System</h2>
<input type="email" id="email" placeholder="Email">
<input type="password" id="password" placeholder="Password">
<button class="primary" onclick="login()">Login</button>
</div>

<!-- DASHBOARD -->
<div id="dashboardView" class="hidden">
<h2 id="welcomeText"></h2>

<div class="card-grid">
<div class="dashboard-card" id="addCard">Add Test</div>
<div class="dashboard-card" id="viewCard">Available Tests</div>
</div>

<button class="danger" onclick="logout()">Logout</button>
</div>

<!-- ADD TEST -->
<div id="addView" class="hidden">
<h2>Add Test</h2>
<input id="testName" placeholder="Test Name">
<textarea id="testCode" placeholder="Paste JSON Code"></textarea>
<button class="primary" id="saveBtn">Save Test</button>
<button onclick="back()">Back</button>
</div>

<!-- TEST LIST -->
<div id="listView" class="hidden">
<h2>Available Tests</h2>
<div id="testsList"></div>
<button onclick="back()">Back</button>
</div>

<!-- CALCULATOR -->
<div id="calcView" class="hidden">
<h2 id="calcTitle"></h2>
<div id="calcInputs"></div>
<div id="calcResults"></div>
<button class="primary" onclick="calculate()">Calculate</button>
<button onclick="back()">Back</button>
</div>

</div>

<script type="module">

import { initializeApp } from "https://www.gstatic.com/firebasejs/12.9.0/firebase-app.js";
import { getAuth, signInWithEmailAndPassword, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/12.9.0/firebase-auth.js";
import { getFirestore, collection, addDoc, getDocs } from "https://www.gstatic.com/firebasejs/12.9.0/firebase-firestore.js";

const firebaseConfig = {
apiKey:"AIzaSyBUUqKaKs9-vDaAoWE2UorKD90SoQe-iMA",
authDomain:"tiles-a850f.firebaseapp.com",
projectId:"tiles-a850f",
storageBucket:"tiles-a850f.firebasestorage.app",
messagingSenderId:"1070603762129",
appId:"1:1070603762129:web:7cd3889cbad403320d8f0"
};

const ADMIN_EMAIL="admin@tilelab.com";

const app=initializeApp(firebaseConfig);
const auth=getAuth(app);
const db=getFirestore(app);

let currentTest=null;

const loginView=document.getElementById("loginView");
const dashboardView=document.getElementById("dashboardView");
const addView=document.getElementById("addView");
const listView=document.getElementById("listView");
const calcView=document.getElementById("calcView");
const saveBtn=document.getElementById("saveBtn");

function show(view){
loginView.classList.add("hidden");
dashboardView.classList.add("hidden");
addView.classList.add("hidden");
listView.classList.add("hidden");
calcView.classList.add("hidden");
view.classList.remove("hidden");
}

window.login=()=>signInWithEmailAndPassword(auth,email.value,password.value).catch(e=>alert(e.message));
window.logout=()=>signOut(auth);

onAuthStateChanged(auth,user=>{
if(user){
show(dashboardView);
welcomeText.innerHTML="Welcome " + user.email;
if(user.email!==ADMIN_EMAIL){
document.getElementById("addCard").style.display="none";
}
loadTests();
}else{
show(loginView);
}
});

document.getElementById("addCard").onclick=()=>show(addView);
document.getElementById("viewCard").onclick=()=>show(listView);

window.back=()=>show(dashboardView);

saveBtn.onclick=async()=>{
saveBtn.disabled=true;
try{
const parsed=JSON.parse(testCode.value);
await addDoc(collection(db,"tests"),{
name:testName.value,
code:parsed
});
alert("Saved");
testName.value="";
testCode.value="";
loadTests();
}catch(e){
alert("Invalid JSON");
}
saveBtn.disabled=false;
};

async function loadTests(){
testsList.innerHTML="";
const snapshot=await getDocs(collection(db,"tests"));
snapshot.forEach(doc=>{
const data=doc.data();
const btn=document.createElement("button");
btn.className="primary";
btn.innerHTML=data.name;
btn.onclick=()=>openCalc(data);
testsList.appendChild(btn);
});
}

function openCalc(test){
currentTest=test;
show(calcView);
calcTitle.innerHTML=test.name;
calcInputs.innerHTML="";
calcResults.innerHTML="";
test.code.inputs.forEach(inp=>{
const field=document.createElement("input");
field.placeholder=inp.label;
field.id=inp.var;
calcInputs.appendChild(field);
});
}

window.calculate=()=>{
let values={};
currentTest.code.inputs.forEach(inp=>{
values[inp.var]=parseFloat(document.getElementById(inp.var).value);
});
let resultObj;
try{
resultObj=Function(...Object.keys(values),currentTest.code.calculate)(...Object.values(values));
}catch(e){
alert("Calculation Error");
return;
}
calcResults.innerHTML="";
currentTest.code.results.forEach(r=>{
const div=document.createElement("div");
div.className="result";
div.innerHTML=r.label+" = "+resultObj[r.key].toFixed(3)+" "+r.unit;
calcResults.appendChild(div);
});
};

</script>

</body>
</html>
